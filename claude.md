# Investie Development Guide for Claude

## 🎯 Project Context
**Investie** is an AI-powered market summary app for beginner-to-intermediate US stock investors. You are assisting with development of a mobile-first React Native app that provides concise, actionable market information through intuitive card-based UI.

### Key Project Details
- **Phase 1**: MVP with summary cards (11 cards total)
  - 1 Market Summary Card (Fear & Greed, VIX, rates, CPI, unemployment, S&P500)
  - 10 Stock Cards (AAPL, TSLA, MSFT, GOOGL, AMZN, NVDA, META, NFLX, AVGO, AMD)
- **Phase 2**: Detailed view mode with charts and deeper analysis
- **Target Users**: Beginner-to-intermediate US stock investors
- **Core Value**: 2-3 minute market overview, updated twice daily (6 AM, 4 PM EST)

## 🛠 Technology Stack

### Frontend (React Native + Expo)
```typescript
- React Native (Expo managed workflow)
- TypeScript (strict mode)
- NativeWind (Tailwind CSS for React Native)
- Zustand (state management)
- React Query (API caching)
- Recharts (charts and sparklines)
- React Navigation v6
```

### Backend (NestJS)
```typescript
- Node.js + NestJS
- PostgreSQL (primary storage)
- Redis (caching layer)
- Firebase Auth (social login)
- JWT tokens (session management)
```

### APIs & Services
- **Google Finance API** ⭐ (Primary): Stock prices, P/E ratios, VIX, market cap
- **FRED API**: Economic indicators (rates, CPI, unemployment)
- **Claude API**: AI summaries, infographics, Fear & Greed search
- **Google News API**: Stock-related news

## 📁 Project Structure

```
investie/
├── apps/
│   ├── mobile/          # React Native app (Expo)
│   │   ├── src/
│   │   │   ├── components/
│   │   │   │   ├── cards/       # Market & stock cards
│   │   │   │   ├── charts/      # Chart components
│   │   │   │   └── ui/          # Common UI components
│   │   │   ├── screens/
│   │   │   ├── hooks/           # Custom React hooks
│   │   │   ├── services/        # API service layer
│   │   │   ├── store/           # Zustand stores
│   │   │   └── types/           # TypeScript types
│   │   └── app.config.js
│   └── backend/         # NestJS API server
│       ├── src/
│       │   ├── modules/
│       │   │   ├── market/      # Market summary endpoints
│       │   │   ├── stocks/      # Individual stock endpoints
│       │   │   ├── news/        # News summarization
│       │   │   └── auth/        # Authentication
│       │   ├── services/        # External API integrations
│       │   └── utils/
│       └── package.json
├── packages/
│   ├── ui/              # Shared UI components
│   ├── types/           # Shared TypeScript types
│   └── utils/           # Shared utilities
└── docs/
```

## 🎨 Component Architecture

### Card Components
```typescript
// Market Summary Card Structure
interface MarketSummaryData {
  fearGreedIndex: {
    value: number;
    status: 'fear' | 'neutral' | 'greed';
    color: string;
  };
  vix: {
    value: number;
    status: 'low' | 'medium' | 'high';
    color: string;
  };
  interestRate: {
    value: number;
    aiOutlook: string; // Generated by Claude
  };
  cpi: {
    value: number;
    monthOverMonth: number;
    direction: 'up' | 'down';
  };
  unemploymentRate: {
    value: number;
    monthOverMonth: number;
  };
  sp500Sparkline: number[];
}

// Stock Card Structure
interface StockCardData {
  symbol: string;
  name: string;
  price: {
    current: number;
    change: number;
    changePercent: number;
  };
  pe: {
    value: number;
    industryAverage: number;
    evaluation: 'undervalued' | 'fair' | 'overvalued';
  };
  marketCap: number;
  volume: number;
  fiftyTwoWeek: {
    high: number;
    low: number;
  };
  rsi: {
    value: number;
    status: 'oversold' | 'neutral' | 'overbought';
  };
  newsSummary: string; // One-line summary from Claude
  sectorPerformance: {
    name: string;
    weeklyChange: number;
  };
}
```

## 🔄 Data Flow & Caching Strategy

### Update Schedule (EST)
- **6:00 AM**: Pre-market summary generation
- **4:00 PM**: Post-market summary generation

### Caching Layers
```typescript
// Client (React Native)
- React Query Cache (API responses) - 5 minutes for stock data
- AsyncStorage (user preferences, watchlist)
- Image Cache (Expo)

// Backend (NestJS)
- Redis L1 Cache (5-minute stock data)
- Redis L2 Cache (12-hour AI summaries)
- PostgreSQL (persistent storage, daily snapshots)
```

### API Integration Pattern
```typescript
// Service Layer Example
@Injectable()
export class MarketDataService {
  constructor(
    private googleFinanceService: GoogleFinanceService,
    private fredService: FredService,
    private claudeService: ClaudeService,
    private cacheService: CacheService,
  ) {}

  async getMarketSummary(): Promise<MarketSummaryData> {
    const cacheKey = 'market-summary';
    const cached = await this.cacheService.get(cacheKey);
    
    if (cached) return cached;

    const [fearGreed, vix, rates, cpi, unemployment, sp500] = await Promise.all([
      this.claudeService.getFearGreedIndex(),
      this.googleFinanceService.getVIX(),
      this.fredService.getInterestRates(),
      this.fredService.getCPI(),
      this.fredService.getUnemploymentRate(),
      this.googleFinanceService.getSP500Data(),
    ]);

    const summary = {
      fearGreedIndex: fearGreed,
      vix,
      interestRate: {
        ...rates,
        aiOutlook: await this.claudeService.generateRateOutlook(rates),
      },
      // ... rest of the data
    };

    await this.cacheService.set(cacheKey, summary, 43200); // 12 hours
    return summary;
  }
}
```

## 🎯 Development Guidelines

### TypeScript Best Practices
- Use explicit type definitions for all financial data
- Prefer `type` over `interface` for better composition
- Create strict validation schemas for API responses
- Use branded types for currency values to prevent errors

### React Native Patterns
```typescript
// Custom Hook Pattern
export const useMarketData = () => {
  return useQuery({
    queryKey: ['market-summary'],
    queryFn: () => marketApi.getSummary(),
    staleTime: 5 * 60 * 1000, // 5 minutes
    cacheTime: 30 * 60 * 1000, // 30 minutes
  });
};

// Component Pattern
export const MarketSummaryCard: React.FC = () => {
  const { data, isLoading, error } = useMarketData();
  
  if (isLoading) return <SkeletonCard />;
  if (error) return <ErrorCard retry={() => refetch()} />;
  
  return (
    <Card className="bg-white rounded-xl p-4 shadow-sm">
      <FearGreedIndicator data={data.fearGreedIndex} />
      <VIXIndicator data={data.vix} />
      {/* ... other indicators */}
    </Card>
  );
};
```

### Styling Conventions (NativeWind)
```typescript
// Use consistent spacing and colors
const styles = {
  card: 'bg-white rounded-xl p-4 shadow-sm mb-4',
  cardTitle: 'text-lg font-semibold text-gray-900 mb-2',
  priceUp: 'text-green-500 font-medium',
  priceDown: 'text-red-500 font-medium',
  neutral: 'text-gray-600',
  sparkline: 'h-8 w-full',
};

// Color coding for financial data
const COLORS = {
  positive: '#10B981', // green-500
  negative: '#EF4444', // red-500
  neutral: '#6B7280',  // gray-500
  fear: '#EF4444',     // red-500
  greed: '#10B981',    // green-500
} as const;
```

## 📊 Error Handling & Loading States

### Error Patterns
```typescript
// Result Pattern for API calls
type Result<T, E = Error> = 
  | { success: true; data: T }
  | { success: false; error: E };

// User-friendly error messages
const ERROR_MESSAGES = {
  NETWORK_ERROR: 'Unable to fetch latest data. Please check your connection.',
  API_LIMIT: 'Market data temporarily unavailable. Please try again later.',
  INVALID_SYMBOL: 'Stock symbol not found.',
  CACHE_MISS: 'Loading fresh data...',
} as const;
```

### Loading States
```typescript
// Skeleton components for better UX
export const SkeletonCard: React.FC = () => (
  <View className="bg-white rounded-xl p-4 shadow-sm mb-4">
    <View className="h-4 bg-gray-200 rounded w-1/3 mb-2 animate-pulse" />
    <View className="h-6 bg-gray-200 rounded w-1/2 mb-4 animate-pulse" />
    <View className="h-8 bg-gray-200 rounded w-full animate-pulse" />
  </View>
);
```

## 🔐 Security & Performance

### API Security
- Store API keys in environment variables
- Implement rate limiting on backend
- Use HTTPS for all communications
- Validate all external API responses

### Performance Optimization
```typescript
// Memoization for expensive calculations
const formatCurrency = useMemo(() => 
  new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
  }), []
);

// Lazy loading for charts
const SparklineChart = lazy(() => import('./SparklineChart'));

// Image optimization
<Image
  source={{ uri: logoUrl }}
  style={{ width: 24, height: 24 }}
  resizeMode="contain"
  cachePolicy="memory-disk"
/>
```

## 🧪 Testing Strategy

### Unit Testing
```typescript
// Test financial calculations
describe('formatCurrency', () => {
  it('should format positive values correctly', () => {
    expect(formatCurrency(1234.56)).toBe('$1,234.56');
  });
  
  it('should handle negative values', () => {
    expect(formatCurrency(-1234.56)).toBe('-$1,234.56');
  });
});

// Test component behavior
describe('StockCard', () => {
  it('should display price increase with green color', () => {
    const mockData = { price: { change: 5.25, changePercent: 2.1 } };
    render(<StockCard data={mockData} />);
    expect(screen.getByText('+2.1%')).toHaveStyle({ color: '#10B981' });
  });
});
```

## 🚀 Deployment Considerations

### Environment Configuration
```typescript
// Environment variables
GOOGLE_FINANCE_API_KEY=
FRED_API_KEY=
CLAUDE_API_KEY=
GOOGLE_NEWS_API_KEY=
DATABASE_URL=
REDIS_URL=
FIREBASE_CONFIG=
```

### Performance Monitoring
- Implement crash reporting with Sentry
- Monitor API response times
- Track user engagement metrics
- Set up alerts for API failures

## 📱 Mobile-First Design Principles

### Responsive Design
- Design for 375px width (iPhone SE) as minimum
- Use percentage-based widths for flexibility
- Implement touch-friendly tap targets (44px minimum)
- Optimize for both portrait and landscape modes

### Accessibility
```typescript
// Accessibility props
<TouchableOpacity
  accessible={true}
  accessibilityLabel="Apple stock card"
  accessibilityHint="Double tap to view detailed information"
  accessibilityRole="button"
>
  <StockCard data={appleData} />
</TouchableOpacity>
```

This guide should help maintain consistency across the development team while building the Investie app. Focus on the mobile-first approach, financial data accuracy, and user experience optimization.